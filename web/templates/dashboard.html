{% extends "base.html" %}

{% block title %}Dashboard - {{ config.APP_NAME }}{% endblock %}

{% block body %}
<!-- Sidebar -->
<aside class="sidebar">
    <div class="sidebar-brand">
        <h4><i class="bi bi-tools me-2"></i>NMM Toolkit</h4>
        <small>Version {{ config.VERSION }} - Web Edition</small>
    </div>

    <nav class="sidebar-nav">
        <div class="nav-section">Main</div>
        <a href="{{ url_for('dashboard') }}" class="nav-link active">
            <i class="bi bi-speedometer2"></i>
            Dashboard
        </a>

        <div class="nav-section mt-3">Tool Categories</div>
        {% for cat_id, cat in categories.items() %}
        <a href="{{ url_for('category', category_id=cat_id) }}" class="nav-link">
            <i class="bi {{ cat.icon }}"></i>
            {{ cat.name }}
        </a>
        {% endfor %}

        <div class="nav-section mt-3">Account</div>
        <a href="{{ url_for('logout') }}" class="nav-link">
            <i class="bi bi-box-arrow-left"></i>
            Sign Out
        </a>
    </nav>
</aside>

<!-- Main Content -->
<main class="main-content">
    <!-- Top Navbar -->
    <nav class="top-navbar">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item active">Dashboard</li>
            </ol>
        </nav>
        <div class="user-menu">
            <span class="text-muted">Welcome,</span>
            <span class="fw-semibold">{{ username }}</span>
            <div class="user-avatar">{{ username[0]|upper }}</div>
        </div>
    </nav>

    <!-- Content Area -->
    <div class="content-area">
        <!-- Welcome Banner -->
        <div class="card bg-primary bg-gradient mb-4 border-0">
            <div class="card-body py-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h3 class="text-white mb-2">
                            <i class="bi bi-tools me-2"></i>{{ config.APP_NAME }}
                        </h3>
                        <p class="text-white-50 mb-0">
                            {{ config.EDITION }} - Comprehensive IT administration toolkit with 60+ integrated tools for system diagnostics, repair, and troubleshooting.
                        </p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <span class="badge bg-light text-primary fs-6 px-3 py-2">
                            <i class="bi bi-gear me-1"></i>{{ categories|length }} Categories
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="rounded-3 p-3 bg-primary bg-opacity-25 me-3">
                                <i class="bi bi-tools text-primary fs-4"></i>
                            </div>
                            <div>
                                <h3 class="mb-0">60+</h3>
                                <small class="text-muted">Total Tools</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="rounded-3 p-3 bg-success bg-opacity-25 me-3">
                                <i class="bi bi-check-circle text-success fs-4"></i>
                            </div>
                            <div>
                                <h3 class="mb-0">Active</h3>
                                <small class="text-muted">System Status</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="rounded-3 p-3 bg-info bg-opacity-25 me-3">
                                <i class="bi bi-pc-display text-info fs-4"></i>
                            </div>
                            <div>
                                <h3 class="mb-0" id="hostname">Loading...</h3>
                                <small class="text-muted">Target Host</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="rounded-3 p-3 bg-warning bg-opacity-25 me-3">
                                <i class="bi bi-person-badge text-warning fs-4"></i>
                            </div>
                            <div>
                                <h3 class="mb-0">{{ 'Admin' if session.get('is_admin') else 'User' }}</h3>
                                <small class="text-muted">Access Level</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tool Categories Grid -->
        <h5 class="mb-3"><i class="bi bi-grid me-2"></i>Tool Categories</h5>
        <div class="row">
            {% for cat_id, cat in categories.items() %}
            <div class="col-lg-4 col-md-6 mb-4">
                <a href="{{ url_for('category', category_id=cat_id) }}" class="category-card">
                    <div class="category-icon bg-{{ cat.color }} bg-opacity-25">
                        <i class="bi {{ cat.icon }} text-{{ cat.color }}"></i>
                    </div>
                    <h5>{{ cat.name }}</h5>
                    <p>{{ cat.description }}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="tool-count">
                            <i class="bi bi-wrench me-1"></i>{{ cat.tools|length }} tools
                        </span>
                        <span class="text-{{ cat.color }}">
                            <i class="bi bi-arrow-right"></i>
                        </span>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>

        <!-- Quick Access -->
        <h5 class="mb-3 mt-4"><i class="bi bi-lightning me-2"></i>Quick Access - Popular Tools</h5>
        <div class="row">
            {% set popular_tools = [
                ('sys_info', 'System Information', 'bi-pc-display', 'primary'),
                ('network_diag', 'Network Diagnostics', 'bi-wifi', 'info'),
                ('azure_ad_health', 'Azure AD Health', 'bi-cloud', 'success'),
                ('battery_health', 'Battery Health', 'bi-battery-charging', 'warning'),
                ('browser_cache_clear', 'Clear Browser Cache', 'bi-globe', 'danger'),
                ('fix_teams', 'Fix Teams Issues', 'bi-lightning', 'secondary')
            ] %}
            {% for tool_id, tool_name, tool_icon, tool_color in popular_tools %}
            <div class="col-lg-2 col-md-4 col-6 mb-3">
                <a href="{{ url_for('tool_page', tool_id=tool_id) }}" class="tool-card card text-decoration-none">
                    <div class="card-body text-center">
                        <div class="tool-icon bg-{{ tool_color }} bg-opacity-25 mx-auto">
                            <i class="bi {{ tool_icon }} text-{{ tool_color }}"></i>
                        </div>
                        <h6 class="card-title mb-0">{{ tool_name }}</h6>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
    // Fetch system info on load
    fetch('/api/system-info')
        .then(response => response.json())
        .then(data => {
            if (data.output) {
                const lines = data.output.trim().split('\n');
                document.getElementById('hostname').textContent = lines[0] || 'localhost';
            }
        })
        .catch(err => {
            document.getElementById('hostname').textContent = 'localhost';
        });
</script>
{% endblock %}
